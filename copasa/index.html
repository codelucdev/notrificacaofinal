<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notificação de Lote Sujo</title>
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <script src="script/script.js"></script>
</head>
<body>
    <div class="container">
        <h2 id="notificacao">NOTIFICAÇÃO COPASA</h2>
        <form id="formulario" method="post" action="#">
            <div>
                <label for="numero_noty">NÚMERO NOTIFICAÇÃO:</label>
                <input type="text" id="numero_noty" name="numero_noty" readonly required>
            </div>
            <!-- Restante do formulário permanece igual -->
            <!-- ... -->
        </form>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.0/html2pdf.bundle.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Buscar o número de notificação automaticamente ao carregar a página
            fetch('https://script.google.com/macros/s/AKfycbxhoIeNCFKMs6nMsSGr_9DWUaEEZoeMztulufIcBCftXwyaBOF5s4uILzGATwcmeAyM1w/exec?action=getNotificationNumber')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Erro na resposta do servidor');
                    }
                    return response.json();
                })
                .then(data => {
                    if (data && data.numero_notificacao) {
                        document.getElementById('numero_noty').value = data.numero_notificacao;
                    } else {
                        document.getElementById('error-message').textContent = 'Erro ao obter o número de notificação.';
                    }
                })
                .catch(error => {
                    console.error('Erro:', error);
                    document.getElementById('error-message').textContent = 'Erro ao obter o número de notificação: ' + error.message;
                });

            document.getElementById('gerarPDF').addEventListener('click', function() {
                var numeroNotifi = document.getElementById('numero_noty').value;
                // Restante do código permanece igual
                // ...

                fetch('https://script.google.com/macros/s/AKfycbxhoIeNCFKMs6nMsSGr_9DWUaEEZoeMztulufIcBCftXwyaBOF5s4uILzGATwcmeAyM1w/exec', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: 'numeroNotifi=' + encodeURIComponent(numeroNotifi)
                })
                .then(response => response.text())
                .then(data => {
                    console.log('Sucesso:', data);
                    // Recarregar a página para obter um novo número de notificação
                    window.location.reload();
                })
                .catch(error => {
                    console.error('Erro:', error);
                    document.getElementById('error-message').textContent = 'Erro ao enviar os dados: ' + error.message;
                });
            });
        });
    </script>
</body>
</html>
